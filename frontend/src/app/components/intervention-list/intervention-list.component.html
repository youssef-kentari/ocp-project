<div class="container-fluid p-3 p-md-4 bg-light min-vh-100">
  <!-- Filters Section -->
  <div class="filters-card card mb-4 border-0 shadow-sm">
    <div class="card-body p-3">
      <div class="">
        <div class="d-flex flex-wrap justify-content-between mb-2">
          <h5 class="mb-0 text-primary fw-semibold">
            <i class="bi bi-funnel "></i>Filters
          </h5>
          <button class="btn btn-primary" (click)="navigateToAddPage()">
            <i class="fas fa-plus"></i> Ajouter
          </button>
        </div>
        <div class="d-flex flex-wrap gap-3 flex-grow-1">
          <!-- Status Filter -->
          <div class="filter-item flex-grow-1" style="min-width: 160px;">
            <label class="form-label small text-muted mb-1">Status</label>
            <select [(ngModel)]="selectedStatut" (change)="getInterventionByStatus(selectedStatut)"
              class="form-select form-select-sm shadow-none">
              <option value="">All Status</option>
              <option *ngFor="let s of status" [value]="s.statut">{{s.statut}}</option>
            </select>
          </div>

          <!-- Responsible Filter -->
          <div class="filter-item flex-grow-1" style="min-width: 160px;">
            <label class="form-label small text-muted mb-1">Responsible</label>
            <select [(ngModel)]="selectedResponsable" (change)="getInterventionByResponsable(selectedResponsable)"
              class="form-select form-select-sm shadow-none">
              <option value="">All Responsible</option>
              <option *ngFor="let r of responsables" [value]="r.responsable">{{r.responsable}}</option>
            </select>
          </div>

          <!-- Designation Filter -->
          <div class="filter-item flex-grow-1" style="min-width: 160px;">
            <label class="form-label small text-muted mb-1">Designation</label>
            <select [(ngModel)]="selectedDesignation" (change)="getInterventionBySE(selectedDesignation)"
              class="form-select form-select-sm shadow-none">
              <option value="">All Designations</option>
              <option *ngFor="let d of designations" [value]="d.designation">{{d.designation}}</option>
            </select>
          </div>

          <!-- Operation Filter -->
          <div class="filter-item flex-grow-1" style="min-width: 160px;">
            <label class="form-label small text-muted mb-1">Operation</label>
            <select [(ngModel)]="selectedOperation" (change)="getInterventionByOperationType(selectedOperation)"
              class="form-select form-select-sm shadow-none">
              <option value="">All Operations</option>
              <option *ngFor="let o of operations" [value]="o.type_operation">{{o.type_operation}}</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="row g-4">
    <!-- Interventions List -->
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-white border-0 py-3">
          <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0 text-dark fw-semibold">
              <i class="bi bi-list-ul me-2"></i>Interventions
            </h4>
            <span class="badge bg-primary rounded-pill">{{ interventions.length || 0 }}</span>
          </div>
        </div>

        <div class="card-body p-0">
          <!-- Loading State -->
          <div *ngIf="loading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted">Loading interventions...</p>
          </div>

          <!-- Empty State -->
          <div *ngIf="!loading && (!interventions || interventions.length === 0)" class="text-center py-5">
            <i class="bi bi-inbox text-muted" style="font-size: 2rem;"></i>
            <p class="mt-2 text-muted">No interventions found</p>
            <button class="btn btn-sm btn-outline-primary mt-2" (click)="resetFilters()">
              Reset filters
            </button>
          </div>

          <!-- Interventions List -->
          <ul class="list-group list-group-flush">
            <li class="list-group-item list-group-item-action py-3 px-3"
              *ngFor="let intervention of interventions; let i = index" [class.active]="i == currentIndex"
              (click)="setActiveIntervention(intervention, i)">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="mb-0 fw-semibold text-truncate" style="max-width: 70%;">
                  <span class="text-muted me-2">#{{ intervention.intervention_id }}</span>
                  {{ intervention.notes || 'No description' }}
                </h6>
                <span class="badge rounded-pill" [ngClass]="{
                  'bg-success': intervention.statut === 'Termine',
                  'bg-warning text-dark': intervention.statut === 'En cours',
                  'bg-secondary': intervention.statut === 'Planifie',
                  'bg-light text-dark': !intervention.statut
                }">
                  {{ intervention.statut || 'N/A' }}
                </span>
              </div>
              <div class="d-flex flex-wrap gap-3 text-muted small mt-2">
                <span class="d-flex align-items-center">
                  <i class="bi bi-calendar me-1"></i>
                  {{ intervention.date_planifiee | date }}
                </span>
                <span class="d-flex align-items-center">
                  <i class="bi bi-tools me-1"></i>
                  {{ intervention.type_intervention || 'No type' }}
                </span>
                <span class="d-flex align-items-center" *ngIf="intervention.responsable">
                  <i class="bi bi-person me-1"></i>
                  {{ intervention.responsable }}
                </span>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Intervention Details -->
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <app-intervention-details [viewMode]="true" [currentIntervention]="currentIntervention"
            (refreshList)="refreshList()">
          </app-intervention-details>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Styles -->
<style>
  .filters-card {
    background-color: #f8f9fa;
    border: 1px solid rgba(0, 0, 0, 0.05);
  }

  .filter-item {
    transition: all 0.2s;
  }

  .list-group-item {
    border-left: 0;
    border-right: 0;
    transition: all 0.2s;
    cursor: pointer;
  }

  .list-group-item:first-child {
    border-top: 0;
  }

  .list-group-item:last-child {
    border-bottom: 0;
  }

  .list-group-item:hover {
    background-color: rgba(13, 110, 253, 0.05);
  }

  .list-group-item.active {
    background-color: rgba(13, 110, 253, 0.1);
    border-color: rgba(0, 0, 0, 0.05);
  }

  .card {
    border-radius: 10px;
    overflow: hidden;
  }

  .form-select-sm {
    font-size: 0.825rem;
    padding: 0.25rem 0.5rem;
  }

  .badge {
    font-weight: 500;
    font-size: 0.75rem;
    padding: 0.35em 0.65em;
  }
</style>